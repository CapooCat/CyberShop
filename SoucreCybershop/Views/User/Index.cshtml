@using CyberShop.Models;
@{
    ViewBag.Title = "Thông tìn người dùng";
    Layout = "~/Views/Shared/_Layout.cshtml";
    List<CyberShop.Models.InvoiceDetailViewModel> listOrderHistory = ViewBag.OrderHistory;
}
@model CyberShop.Models.UserViewModel
@section style{
    <style>
        .alert {
            padding: 20px;
            background-color: #f44336;
            color: white;
            opacity: 1;
            transition: opacity 0.6s;
            margin-bottom: 15px;
        }

            .alert.success {
                background-color: #58EA64;
            }

            .alert.info {
                background-color: #2196F3;
            }

            .alert.warning {
                background-color: #ff9800;
            }

        .closebtn {
            margin-left: 15px;
            color: white;
            font-weight: bold;
            float: right;
            font-size: 22px;
            line-height: 20px;
            cursor: pointer;
            transition: 0.3s;
        }

            .closebtn:hover {
                color: black;
            }
    </style>
}
<section class="container" style="padding-top: 160px; padding-bottom: 50px;">
    <h3><i class="fas fa-user-cog" style="margin-right: 10px;"></i>Thông tin người dùng</h3>
    <ul class="breadcrumb Page-address">
        <li class="breadcrumb-item"><a href="#"><i class="fas fa-home" style="margin-right: 10px"></i>Trang chủ</a></li>
        <li class="breadcrumb-item active">Thông tin người dùng</li>
    </ul>
    <h1 style="text-align: center; margin: 50px;">Thông tin người dùng</h1>
    @if (ViewBag.Warning != null)
    {
        <div class="alert warning">
            <span class="closebtn">&times;</span>
            <strong></strong><div style="text-align:center">Vui lòng nhập đầy đủ thông tin cần thiết</div>
        </div>
    }
    @if (ViewBag.Success != null)
    {
        <div class="alert success">
            <span class="closebtn">&times;</span>
            <strong></strong><div style="text-align:center">@ViewBag.Success</div>
        </div>
    }
        <form method="post" action="/User/Index">
            <div class="row">
                <div class="error col-md-12" id="Post_Error">
                    <ul>
                        @Html.ValidationSummary(false, "", "alert alert-danger")
                    </ul>
                </div>
                <div class="col-md-6 input-info">
                    <h6>
                        @*<input type="text" placeholder="Họ và tên..." name="search">*@
                        @Html.LabelFor(model => model.Name)
                        @Html.TextBoxFor(model => model.Name, new {@*@name="search"*@})
                    </h6>
                    <h6>
                        @*<input type="text" placeholder="Tên tài khoản..." name="search">*@
                        @Html.LabelFor(model => model.Username)
                        @Html.TextBoxFor(model => model.Username, new { @value = Model.Username, @style = "background-color: #808080", @readonly = true,})
                    </h6>
                    <h6>
                        @*<input type="text" placeholder="Email..." name="search">*@
                        @Html.LabelFor(model => model.Email)
                        @Html.TextBoxFor(model => model.Email, new{ @value = Model.Email, @style= "background-color: #808080", @readonly = true,})
                    </h6>
                </div>
                <div class="col-md-6 input-info">
                    <h6>
                        @*<input type="text" placeholder="Số điện thoại..." name="search">*@
                        @Html.LabelFor(model => model.PhoneNum)
                        @Html.TextBoxFor(model => model.PhoneNum, new{ @*@name = "search"*@ @id = "key", @class = "numberonly", })
                    </h6>
                    <h6>
                        @*<input type="text" placeholder="Địa chỉ..." name="search">*@
                        @Html.LabelFor(model => model.Address)
                        @Html.TextBoxFor(model => model.Address, new { @*@name = "search"*@ })
                    </h6>
                </div>
                <div class="btn-submit col-md-12">
                    <button type="submit">Xác nhận thay đổi</button>
                </div> 
            </div>
    </form>
    <div class="row">
        <div class="btn-submit col-md-12" style="margin-top: 10px;">
            <button data-toggle="modal" data-target="#PasswordModal" onclick="OpenPassChangeModal();">Đổi mật khẩu</button>
        </div>
    </div>


    <h1 style="text-align: center; margin: 50px;">Lịch sử mua hàng</h1>
    <table>
        <tr>
            <th style="width: 10%;">Mã hóa đơn</th>
            <th style="width: 35%;">Tên sản phẩm</th>
            <th style="width: 10%;">Số lượng</th>
            <th style="width: 20%;">Giá</th>
            <th style="width: 15%;">Ngày mua</th>
            <th style="width: 10%;">Tình trạng</th>
        </tr>
        @foreach (InvoiceDetailViewModel item in listOrderHistory)
        {
        <tr>
            <td>@item.Invoice_id</td>
            <td><a href="#">@item.ProductName</a></td>
            <td>@item.Amount</td>
            <td>@string.Format("{0:#,##0.00}", item.Price)</td>
            <td>@item.CreateDate</td>
            @if (item.Status == "Chưa hoàn thành")
            {<td>Chưa nhận</td> }
            else
            {
            <td>Đã nhận</td> }
        </tr>
        }
    </table>

    <div class="modal fade" id="PasswordModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLongTitle">Đổi mật khẩu</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">




                <div class="row product-input" style="padding-top: 10px;padding-bottom: 10px; text-align: center;">
                    <div class="col-md-12">
                        <p>Nhập mật khẩu cũ:</p>
                        <input style="width:100%;margin-left:0;margin-right:0" type="password" placeholder="Nhập mật khẩu cũ..." id="old_pass">
                    </div>
                    <div class="col-md-12">
                        <button ng-click="RequestChangePass('@Model.Username');">Yêu cầu đổi mật khẩu</button>
                    </div>
                    <div class="col-md-12">
                        <p>Mật khẩu mới:</p>
                        <input style="width:100%;margin-left:0;margin-right:0" type="password" placeholder="Nhập mật khẩu mới..." id="new_pass">
                    </div>
                    <div class="col-md-12">
                        <p>Nhập lại mật khẩu:</p>
                        <input style="width:100%;margin-left:0;margin-right:0" type="password" placeholder="Nhập lại mật khẩu..." id="re_enter_pass">
                    </div>
                    <div class="col-md-12">
                        <button id="Confirm_change" ng-click="ChangePass('@Model.Username');">Xác nhận</button>
                    </div>
                </div>




            </div>
            <div class="modal-footer">
                <button type="button" class="second-btn" data-dismiss="modal">Thoát</button>
            </div>
        </div>
    </div>
    </div>
</section>
@section scripts{
<script>

    function OpenPassChangeModal() {
        document.getElementById("new_pass").disabled = true;
        document.getElementById("re_enter_pass").disabled = true;
        document.getElementById("Confirm_change").disabled = true;
        document.getElementById("Confirm_change").className = "Disabled";
        document.getElementById("new_pass").value = "";
        document.getElementById("re_enter_pass").value = "";
        document.getElementById("old_pass").value = "";
    }


    var close = document.getElementsByClassName("closebtn");
    var i;

    for (i = 0; i < close.length; i++) {
      close[i].onclick = function(){
        var div = this.parentElement;
        div.style.opacity = "0";
        setTimeout(function(){ div.style.display = "none"; }, 600);
      }
    }

	    var myInput = document.getElementById('key');
	    myInput.addEventListener('keypress', function(e) {
      var key = !isNaN(e.charCode) ? e.charCode : e.keyCode;
      function keyAllowed() {
        var keys = [8,9,13,16,17,18,19,20,27,46,48,49,50,
                    51,52,53,54,55,56,57,91,92,93];
        if (key && keys.indexOf(key) === -1)
          return false;
        else
          return true;
  			    }
      if (!keyAllowed())
        e.preventDefault();
	    }, false);

	    var x = document.getElementById("Post_Error");
	    var list = x.getElementsByTagName("UL")[0];
	    if (list.getElementsByTagName("LI")[0].innerHTML != "") {
	        x.style.display = 'inline-block';
	    } else {
	        x.style.display = 'none';
	    }
</script>
    }

